<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://mwtaylor.github.io/ElephantLogos/elephant_itr100.png><title itemprop=name>Elephant in the Room - Starting a Personal Mastodon Server</title><meta property="og:title" content="Elephant in the Room - Starting a Personal Mastodon Server"><meta name=twitter:title content="Elephant in the Room - Starting a Personal Mastodon Server"><meta itemprop=name content="Elephant in the Room - Starting a Personal Mastodon Server"><meta name=application-name content="Elephant in the Room - Starting a Personal Mastodon Server"><meta property="og:site_name" content="Elephant In The Room"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://elephantintheroom.dev/posts/mastodon-setup/><link rel=canonical href=https://elephantintheroom.dev/posts/mastodon-setup/ itemprop=url><meta name=url content="https://elephantintheroom.dev/posts/mastodon-setup/"><meta name=twitter:url content="https://elephantintheroom.dev/posts/mastodon-setup/"><meta property="og:url" content="https://elephantintheroom.dev/posts/mastodon-setup/"><meta property="og:updated_time" content="10009-10-08T929:03:23-0700"><link rel=sitemap type=application/xml title=Sitemap href=https://elephantintheroom.dev/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content="Elephant In The Room"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="10009-10-08T929:03:23-0700"><meta property="article:published_time" content="10009-10-08T929:03:23-0700"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Starting a Personal Mastodon Server","author":{"@type":"Person","name":"https:\/\/github.com\/mwtaylor\/DevelopmentBlog"},"datePublished":"2023-09-10","description":"","wordCount":"1535","mainEntityOfPage":"True","dateModified":"2023-09-10","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"Elephant In The Room","logo":{"@type":"imageObject","url":"https:\/\/mwtaylor.github.io\/ElephantLogos\/elephant_itr100.png"}}}</script><meta name=generator content="Hugo 0.118.2"><link type=text/css rel=stylesheet href=/css/bundle.min.5cca4e2a83cddce1c0b55d45fc5b590847345d3c5c33a5ff094a4a01cbef3690.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://elephantintheroom.dev/><img src=https://mwtaylor.github.io/ElephantLogos/elephant_itr400.png alt="brand image"></a>
<a href=https://elephantintheroom.dev/><h1>Elephant In The Room</h1></a></h1><p class=lead></p></div><nav><ul class=sidebar-nav><li class=heading><a href=/about/>About</a></li><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://elephantintheroom.dev/posts/mastodon-setup/>Starting a Personal Mastodon Server</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/mwtaylor/DevelopmentBlog><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social rel=me title=Mastodon href=https://mwtaylor.social/@Michael><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill="currentcolor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26-1.31.15-2.6.3-3.97.24-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42 1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56.0 5.02.3 6.47.96.0.0 2.83 1.27 2.83 5.61.0.0.04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56-.56-.63-1.3-.96-2.23-.96-1.06.0-1.87.41-2.42 1.23l-.5.88-.5-.88c-.56-.82-1.36-1.23-2.43-1.23-.92.0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62 1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93.9.0 1.35.56 1.35 1.62v5.11H18V8.91z"/></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br><br><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/88x31.png></a>
This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://elephantintheroom.dev/posts/mastodon-setup/>Starting a Personal Mastodon Server</a></h1><time datetime=2023-09-10T20:29:03-0700 class=post-date>September 10, 2023</time><p class=seriesname>Series: <a href=https://elephantintheroom.dev/series/personal-mastodon-server>Personal Mastodon Server</a></p></div><p>Mastodon is a micro-blogging platform similar to Twitter. It is decentralized so there isn&rsquo;t just one central Mastodon
server. Instead, anyone can start up their own Mastodon instance. All of these instances federate together. This means
if you sign up and post on one server then everyone on other Mastodon servers can follow you and see your posts.</p><p>When you run a Mastodon server it can be configured for anyone to be able to sign up, or limited to just yourself or a
small group of invite only accounts.</p><p>I would recommend most people interested in Mastodon sign up on an existing server. The creators of Mastodon run the
server <a href=https://mastodon.social target=_blank>mastodon.social</a> which is a great choice. They also maintain a list of
<a href=https://joinmastodon.org/servers target=_blank>alternate servers</a> that all commit to the
<a href=https://joinmastodon.org/covenant target=_blank>Mastodon Server Covenant</a> which specifies some basic rules around server
availability and moderation. Browse through this and see if you find one that interests you. Remember that no matter
which server you choose you can still interact with everyone else on other Mastodon servers.</p><p><img src=MastodonHeader.png alt="Screenshot of my Mastodon home page" title="Mastodon Home"></p><h1 id=why-set-up-your-own-server>Why Set Up Your Own Server</h1><p>Setting up a Mastodon server gives complete control over your data. You can be sure that no one else can access your
private data. With most social media companies you might assume that there are internal controls to prevent employees
from accessing your data unless needed. With Mastodon, it is harder to know this because anyone can be an instance
admin, and you often have to take their word that they will use your data appropriately.</p><p>You also don&rsquo;t have to worry about your data and account suddenly disappearing. There have been Mastodon instances that
have suddenly shut down due to financial or other reasons. In most cases the admins of a shutting down instance should
give users time to migrate their account as specified in the Mastodon Server Covenant. However, this isn&rsquo;t a binding
contract and instances could still shut down without notice.</p><h2 id=the-flip-side>The Flip Side</h2><p>Of course there are downsides as well to maintaining your own instance. You have to take the time for all the setup and
ongoing maintenance. It&rsquo;s pretty straight forward if you have experience administering servers, but still some time
commitment.</p><p>You are also on your own for securing everything. If you know what you are doing then your instance may be more secure
than others. But you can also miss something and be open to hacking.</p><p>All the costs must be paid by you. Most Mastodon servers are free to join and rely on user donations. You need to pay
for server hosting, data storage, bandwidth, and domain registration.</p><h2 id=my-experience-going-forward>My Experience Going Forward</h2><p>I set up my own Mastodon server and this was my experience. I don&rsquo;t intend for this to be a tutorial. Instead, it is
just chronicling my experience for anyone who might consider doing this for themselves to learn from my mistakes and
successes. I mostly choose to do this to learn and get some experience with server administration and I want to share
what I have learned.</p><h1 id=the-setup>The Setup</h1><p>Most of the setup is documented on the <a href=https://docs.joinmastodon.org/user/run-your-own/ target=_blank>Mastodon documentation</a>. I set
up my server when Mastodon was at version 4.1. Any changes for installation of later versions will not be documented
here. As a reminder this is not a tutorial, always follow the latest official documentation.</p><p>The setup starts with some prerequisites.</p><h2 id=prerequisites>Prerequisites</h2><h3 id=domain-name>Domain Name</h3><p>I initially used Google Domains to register my domain name. Google Domains is shutting down and selling customer
accounts to Squarespace so shouldn&rsquo;t be used anymore. I have switched to using PorkBun for domain registration, and it
has been working well. I recommend PorkBun if you don&rsquo;t have an existing domain registrar you already use.</p><h3 id=server-hosting>Server Hosting</h3><p>I used AWS EC2 to get a server for hosting Mastodon on. The Mastodon documentation list a lot of good options that may
be cheaper than AWS. I choose AWS because I am the most familiar with it already and wanted to maintain my knowledge.</p><p>I always recommend setting up a new AWS account per project. So even if you already have a personal account or some
other account you might consider using, you should create a new account just for Mastodon. It keeps all your resources
separated and prevents any accidental effects from one project on another. You also get to take advantage of the entire
free tier per account.</p><p>With your new account launch a new EC2 instance in the region closest to you. I used a t4g.small instance because there
is a <a href=https://repost.aws/articles/ARdZ3_Qv8TQdyWhmy4npRMRQ/announcing-amazon-ec2-t4g-free-trial-extension target=_blank>free trial until the end of 2023</a>.</p><p>There are smaller t4g instances but I would be hesitant to go much smaller because of the somewhat high memory needs
when compiling Mastodon. The t4g.small pricing after the free trial seems like a reasonable amount for the higher amount
of RAM. I have not yet encountered any need to go with a larger sized instance. I will write up another post in this
series about how much I pay for my Mastodon setup after running it for a month or two.</p><p>Mastodon runs well on Graviton ARM processors, so I would recommend sticking with one of the &ldquo;g&rdquo; server types for cost
savings if considering other options. The &ldquo;t&rdquo; burstable instance type works well for Mastodon for more cost savings. The
CPU use is generally low and I will write another post in this series about setting up monitoring to make sure you
aren&rsquo;t being charged for bursts.</p><p>Use the OS image for the recommended version of Ubuntu called for in the Mastodon documentation (Ubuntu 20.04 LTS when I
set it up).</p><p>Create a key pair for SSH access to this server and save it. Save it somewhere secure that is backed up. If you lose the
key it is possible to recover access to your server, but it is not easy. There are some instructions
<a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/TroubleshootingInstancesConnecting.html target=_blank>here</a> under the section &ldquo;I&rsquo;ve lost my private key. How can I connect to my Linux instance?&rdquo;.</p><p>Configure access through the security group for all IPs to access ports 80 and 443.</p><p>I set up access to the SSH port to my IP address only and remove this access when not needed. You could also just allow
SSH access for all IPs.</p><h3 id=email-provider>Email Provider</h3><p>I use the AWS email service SES. SES requires creating a support request to access the production version of SES. This
makes sure you aren&rsquo;t using SES to send any spam emails. Until this is complete your account will be in the SES sandbox.</p><p>It actually isn&rsquo;t required for a single user Mastodon instance to have production SES access. I use SES in the sandbox
and haven&rsquo;t had any issue. In the sandbox you can only send to verified users. Your email will be the only recipient of
the Mastodon emails so this isn&rsquo;t an issue as you can verify your own email address in SES. If you will have more users
on your Mastodon instance consider using an alternate email provider.</p><p>Go to SES in the AWS console for the region closest to you. Click &ldquo;Create identity&rdquo;. Select the &ldquo;Domain&rdquo; identity type.
Put in the domain you are using for your Mastodon server. Then click &ldquo;Use a custom MAIL FROM domain&rdquo; with the subdomain
&ldquo;mail&rdquo;. Don&rsquo;t publish to Route 53 unless you are using Route 53 for your domain registrar. I left the rest as default
and created the identity.</p><p><img src=CreateSESIdentity.png alt="Screenshot of the AWS console with the configuration in this post filled in on the SES create identity form" title="SES settings in AWS console"></p><p>Publish the DNS records in your domain registrar that AWS gives you for MAIL FROM and DKIM.</p><h3 id=object-storage-provider>Object Storage Provider</h3><p>I decided at first to not use an object storage provider. If storage becomes an issue on my server I may change this
later to use S3. I set up my EC2 server to have a 30 GB EBS volume.</p><h2 id=prepare-server>Prepare Server</h2><p>Follow all the server preparation steps in the Mastodon documentation to set up fail2ban and the firewall. I only set up
the firewall for IPv4 because my server is not accessible over IPv6.</p><p>Install all the prerequisites for installing Mastodon from source.</p><p>For the PostgreSQL setup I did not use pgTune and followed all other steps and it has worked well for me so far.</p><p>Run all the commands in the documentation to setup Mastodon and nginx.</p><h3 id=get-a-ssl-certificate-from-lets-encrypt>Get a SSL certificate from Let&rsquo;s Encrypt</h3><p>I had issues with the steps in the documentation not working to get an SSL certificate. Here&rsquo;s what I had to do instead.</p><p>First make sure that your DNS record is set up. Assign a public IPv4 address to your instance using Elastic IPs to get
an address and attach it to your instance. Add an A record to your domain that points to this elastic IP address.</p><p>I followed steps 5 and 7 on <a href=https://www.linuxbabe.com/ubuntu/how-to-install-mastodon-on-ubuntu target=_blank>this page</a> to get Let&rsquo;s Encrypt to issue a certificate.</p><h3 id=setup-email>Setup Email</h3><p>Here&rsquo;s the settings I used to configure Mastodon to send emails with SES in the .env.production file:</p><pre tabindex=0><code>SMTP_SERVER=email-smtp.us-west-2.amazonaws.com
SMTP_PORT=465
SMTP_LOGIN=AXXX
SMTP_PASSWORD=XXXXXXXXXXXX
SMTP_AUTH_METHOD=plain
SMTP_OPENSSL_VERIFY_MODE=none
SMTP_ENABLE_STARTTLS=never
SMTP_TLS=true
SMTP_FROM_ADDRESS=&#39;Mastodon &lt;notifications@mwtaylor.social&gt;&#39;
</code></pre><h1 id=use-your-server>Use Your Server</h1><p>You should now be able to log in with your user and start posting. A future post in this series will give some tips
about how to start getting content from other users to your server.</p><hr><div class=footer><p>This is a post in the <b><a href=https://elephantintheroom.dev/series/personal-mastodon-server>Personal Mastodon Server</a></b> series.<br>Other posts in this series:<ul class=series><li>September 10, 2023 -
Starting a Personal Mastodon Server</li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#why-set-up-your-own-server>Why Set Up Your Own Server</a><ul><li><a href=#the-flip-side>The Flip Side</a></li><li><a href=#my-experience-going-forward>My Experience Going Forward</a></li></ul></li><li><a href=#the-setup>The Setup</a><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#domain-name>Domain Name</a></li><li><a href=#server-hosting>Server Hosting</a></li><li><a href=#email-provider>Email Provider</a></li><li><a href=#object-storage-provider>Object Storage Provider</a></li></ul></li><li><a href=#prepare-server>Prepare Server</a><ul><li><a href=#get-a-ssl-certificate-from-lets-encrypt>Get a SSL certificate from Let&rsquo;s Encrypt</a></li><li><a href=#setup-email>Setup Email</a></li></ul></li></ul></li><li><a href=#use-your-server>Use Your Server</a></li></ul></nav></div></div></div></body></html>